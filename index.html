<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í•˜ë‚˜ë¡œ ë§Œë“  ëª¨ë°”ì¼ í…ŒíŠ¸ë¦¬ìŠ¤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <style>
        body {
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: space-around; 
            height: 100vh; 
            margin: 0;
            overflow: hidden; 
            touch-action: manipulation; 
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
            max-width: 400px;
        }

        #side-panel {
            text-align: center;
            margin-bottom: 10px;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr); 
            grid-template-rows: repeat(20, 1fr);   
            width: 100%;
            aspect-ratio: 1 / 2; 
            border: 5px solid #333;
            background-color: #111;
        }

        .cell {
            border: 1px solid #222;
            box-sizing: border-box;
        }

        /* ë¸”ë¡ ìƒ‰ê¹” */
        .block-i { background-color: #00ffff; border-color: #00dddd; }
        .block-o { background-color: #ffff00; border-color: #dddd00; }
        .block-t { background-color: #800080; border-color: #6a006a; }
        .block-j { background-color: #0000ff; border-color: #0000dd; }
        .block-l { background-color: #ffaa00; border-color: #dd9900; }
        .block-s { background-color: #00ff00; border-color: #00dd00; }
        .block-z { background-color: #ff0000; border-color: #dd0000; }

        /* ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #mobile-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 90%;
            max-width: 400px;
            padding: 10px 0;
        }

        .control-btn {
            padding: 15px 25px;
            font-size: 1.5rem;
            height: 70px;
            border-radius: 10px;
            background-color: #4a90e2;
            color: white;
            border: none;
            box-shadow: 0 4px 0 #3b73b9;
            touch-action: manipulation; 
        }

        .control-btn:active {
            box-shadow: 0 1px 0 #3b73b9;
            transform: translateY(3px);
        }

        #start-button {
            padding: 10px 20px;
            font-size: 1rem;
        }
    </style>
    </head>
<body>
    <div id="game-container">
        <div id="side-panel">
            <p>ì ìˆ˜: <span id="score">0</span></p>
            <button id="start-button">ì‹œì‘</button>
        </div>
        
        <div id="game-board">
        </div>
    </div>

    <div id="mobile-controls">
        <button id="left" class="control-btn">â¬…ï¸</button>
        <button id="rotate" class="control-btn">ğŸ”„</button>
        <button id="right" class="control-btn">â¡ï¸</button>
        <button id="down" class="control-btn down-btn">â¬‡ï¸</button>
    </div>

    <script>
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        let score = 0;
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        let gameTimer;
        let isGameOver = true;

        let board = Array.from({ length: BOARD_HEIGHT }, () => Array(BOARD_WIDTH).fill(0));

        const TETROMINOES = [
            { shape: [[1, 1, 1, 1]], id: 1, name: 'i' },
            { shape: [[2, 2, 0], [0, 2, 2]], id: 2, name: 'z' },
            { shape: [[0, 3, 3], [3, 3, 0]], id: 3, name: 's' },
            { shape: [[4, 4], [4, 4]], id: 4, name: 'o' },
            { shape: [[5, 5, 5], [0, 0, 5]], id: 5, name: 'l' },
            { shape: [[6, 6, 6], [6, 0, 0]], id: 6, name: 'j' },
            { shape: [[7, 7, 7], [0, 7, 0]], id: 7, name: 't' }
        ];

        let currentPiece;
        let currentX;
        let currentY;

        // ê²Œì„ ì‹œì‘/ì¬ì‹œì‘
        document.getElementById('start-button').addEventListener('click', startGame);

        function startGame() {
            if (!isGameOver) return;
            
            board = Array.from({ length: BOARD_HEIGHT }, () => Array(BOARD_WIDTH).fill(0));
            score = 0;
            scoreDisplay.textContent = score;
            isGameOver = false;

            newPiece();
            
            // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆë‹¤ë©´ ë©ˆì¶”ê³  ìƒˆë¡œ ì‹œì‘
            if (gameTimer) clearInterval(gameTimer);
            gameTimer = setInterval(moveDown, 1000);
            document.getElementById('start-button').textContent = "ì¼ì‹œì •ì§€";
        }

        function newPiece() {
            const randomIndex = Math.floor(Math.random() * TETROMINOES.length);
            currentPiece = {
                shape: JSON.parse(JSON.stringify(TETROMINOES[randomIndex].shape)), // ê¹Šì€ ë³µì‚¬
                id: TETROMINOES[randomIndex].id,
                name: TETROMINOES[randomIndex].name
            };
            currentX = 3;
            currentY = 0;

            if (checkCollision(currentX, currentY, currentPiece.shape)) {
                clearInterval(gameTimer);
                alert('ê²Œì„ ì˜¤ë²„! ì ìˆ˜: ' + score);
                isGameOver = true;
                document.getElementById('start-button').textContent = "ì¬ì‹œì‘";
            }
        }

        function checkCollision(nextX, nextY, pieceShape) {
            for (let y = 0; y < pieceShape.length; y++) {
                for (let x = 0; x < pieceShape[y].length; x++) {
                    if (pieceShape[y][x]) {
                        const newX = nextX + x;
                        const newY = nextY + y;

                        // 1. ë³´ë“œ ë°– ê²½ê³„ í™•ì¸
                        if (newX < 0 || newX >= BOARD_WIDTH || newY >= BOARD_HEIGHT) {
                            return true;
                        }
                        // 2. ì´ë¯¸ ìŒ“ì¸ ë¸”ë¡ê³¼ ê²¹ì¹¨ í™•ì¸ (newY >= 0ì„ ì¶”ê°€í•˜ì—¬ ë³´ë“œ ìœ„ìª½ ê²½ê³„ë¥¼ ë²—ì–´ë‚˜ëŠ” ê²ƒì€ ë¬´ì‹œ)
                        if (newY >= 0 && board[newY][newX] !== 0) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        function movePiece(dx, dy) {
            if (isGameOver) return;
            if (checkCollision(currentX + dx, currentY + dy, currentPiece.shape)) {
                if (dy === 1) {
                    lockPiece();
                }
                return false;
            }
            currentX += dx;
            currentY += dy;
            draw();
            return true;
        }

        function moveDown() {
            movePiece(0, 1);
        }

        function lockPiece() {
            for (let y = 0; y < currentPiece.shape.length; y++) {
                for (let x = 0; x < currentPiece.shape[y].length; x++) {
                    if (currentPiece.shape[y][x]) {
                        board[currentY + y][currentX + x] = currentPiece.id;
                    }
                }
            }
            clearLines();
            newPiece();
        }

        function clearLines() {
            let linesCleared = 0;
            for (let y = BOARD_HEIGHT - 1; y >= 0; y--) {
                if (board[y].every(cell => cell !== 0)) {
                    board.splice(y, 1);
                    board.unshift(Array(BOARD_WIDTH).fill(0));
                    linesCleared++;
                    y++; // ì¤„ì„ ì§€ì› ìœ¼ë‹ˆ ë‹¤ì‹œ ê²€ì‚¬
                }
            }
            if (linesCleared > 0) {
                score += linesCleared * 10; // ì§€ìš´ ì¤„ ìˆ˜ë§Œí¼ ì ìˆ˜ ì¶”ê°€
                scoreDisplay.textContent = score;
            }
        }

        function rotatePiece() {
            if (isGameOver) return;
            const rows = currentPiece.shape.length;
            const cols = currentPiece.shape[0].length;
            let newShape = Array(cols).fill(0).map(() => Array(rows).fill(0));

            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    newShape[x][rows - 1 - y] = currentPiece.shape[y][x];
                }
            }
            
            if (!checkCollision(currentX, currentY, newShape)) {
                currentPiece.shape = newShape;
                draw();
            }
        }

        // í™”ë©´ ê·¸ë¦¬ê¸° (ë Œë”ë§)
        function draw() {
            gameBoard.innerHTML = '';
            
            // ë³´ë“œì™€ ìŒ“ì¸ ë¸”ë¡ ê·¸ë¦¬ê¸°
            for (let y = 0; y < BOARD_HEIGHT; y++) {
                for (let x = 0; x < BOARD_WIDTH; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    if (board[y][x] !== 0) {
                        const pieceName = TETROMINOES.find(t => t.id === board[y][x]).name;
                        cell.classList.add(`block-${pieceName}`);
                    }
                    gameBoard.appendChild(cell);
                }
            }

            // í˜„ì¬ ë–¨ì–´ì§€ëŠ” ë¸”ë¡ ê²¹ì³ì„œ ê·¸ë¦¬ê¸°
            if (currentPiece) {
                for (let y = 0; y < currentPiece.shape.length; y++) {
                    for (let x = 0; x < currentPiece.shape[y].length; x++) {
                        if (currentPiece.shape[y][x]) {
                            const cellIndex = (currentY + y) * BOARD_WIDTH + (currentX + x);
                            const cell = gameBoard.children[cellIndex];
                            if (cell) {
                                cell.classList.add(`block-${currentPiece.name}`);
                            }
                        }
                    }
                }
            }
        }

        // ëª¨ë°”ì¼ ë²„íŠ¼ í„°ì¹˜ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById('left').addEventListener('touchstart', (e) => {
            e.preventDefault();
            movePiece(-1, 0);
        });

        document.getElementById('right').addEventListener('touchstart', (e) => {
            e.preventDefault();
            movePiece(1, 0);
        });

        document.getElementById('down').addEventListener('touchstart', (e) => {
            e.preventDefault();
            movePiece(0, 1);
        });

        document.getElementById('rotate').addEventListener('touchstart', (e) => {
            e.preventDefault();
            rotatePiece();
        });

        draw(); // ì´ˆê¸° í™”ë©´ ê·¸ë¦¬ê¸°
    </script>
    </body>
</html>
