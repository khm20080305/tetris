<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚˜ë§Œì˜ í…ŒíŠ¸ë¦¬ìŠ¤ ê²Œì„</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="game-container">
        <div id="side-panel">
            <p>ì ìˆ˜: <span id="score">0</span></p>
            <button id="start-button">ì‹œì‘</button>
        </div>
        
        <div id="game-board">
            </div>
    </div>

    <div id="mobile-controls">
        <button id="left" class="control-btn">â¬…ï¸</button>
        <button id="rotate" class="control-btn">ğŸ”„</button>
        <button id="right" class="control-btn">â¡ï¸</button>
        <button id="down" class="control-btn down-btn">â¬‡ï¸</button>
    </div>

    <script src="script.js"></script>
</body>
</html>
body {
    display: flex;
    flex-direction: column; /* ìš”ì†Œë¥¼ ì„¸ë¡œë¡œ ë°°ì¹˜ */
    align-items: center;
    justify-content: space-around; /* ìš”ì†Œë“¤ì„ ì ë‹¹íˆ ë„ì›Œì¤ë‹ˆë‹¤ */
    height: 100vh; /* í™”ë©´ ë†’ì´ì— ê½‰ ì±„ìš°ê¸° */
    margin: 0;
    overflow: hidden; /* ìŠ¤í¬ë¡¤ ëª»í•˜ê²Œ ë§‰ê¸° */
    touch-action: manipulation; /* í™”ë©´ í™•ëŒ€/ì¶•ì†Œ ë§‰ê¸° */
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
}

#game-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 90%;
    max-width: 400px; /* ë„ˆë¬´ í° í™”ë©´ì—ì„œëŠ” ì ë‹¹íˆ í¬ê¸° ì œí•œ */
}

#side-panel {
    text-align: center;
    margin-bottom: 10px;
}

#game-board {
    display: grid;
    /* ì˜†ìœ¼ë¡œ 10ì¹¸, ì•„ë˜ë¡œ 20ì¹¸ ë‚˜ëˆ„ê¸° */
    grid-template-columns: repeat(10, 1fr); 
    grid-template-rows: repeat(20, 1fr);   
    width: 100%;
    /* ë³´ë“œê°€ 10x20 ë¹„ìœ¨ì„ ìœ ì§€í•˜ë„ë¡ í•©ë‹ˆë‹¤. */
    aspect-ratio: 1 / 2; 
    border: 5px solid #333;
    background-color: #111;
}

.cell {
    /* ê° ì¹¸ì˜ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    border: 1px solid #222;
    box-sizing: border-box;
}

/* ë¸”ë¡ ìƒ‰ê¹” ê¾¸ë¯¸ê¸° (ë‚˜ì¤‘ì— JSì—ì„œ 'block-i', 'block-o' ë“±ìœ¼ë¡œ ì‚¬ìš©) */
.block-i { background-color: #00ffff; border-color: #00dddd; } /* í•˜ëŠ˜ìƒ‰ */
.block-o { background-color: #ffff00; border-color: #dddd00; } /* ë…¸ë€ìƒ‰ */
.block-t { background-color: #800080; border-color: #6a006a; } /* ë³´ë¼ìƒ‰ */
.block-j { background-color: #0000ff; border-color: #0000dd; } /* íŒŒë€ìƒ‰ */
.block-l { background-color: #ffaa00; border-color: #dd9900; } /* ì£¼í™©ìƒ‰ */
.block-s { background-color: #00ff00; border-color: #00dd00; } /* ì´ˆë¡ìƒ‰ */
.block-z { background-color: #ff0000; border-color: #dd0000; } /* ë¹¨ê°„ìƒ‰ */

/* ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
#mobile-controls {
    display: flex;
    justify-content: space-around;
    align-items: center;
    width: 90%;
    max-width: 400px;
    padding: 10px 0;
}

.control-btn {
    padding: 15px 25px;
    font-size: 1.5rem;
    height: 70px;
    border-radius: 10px;
    background-color: #4a90e2;
    color: white;
    border: none;
    box-shadow: 0 4px 0 #3b73b9;
    /* í„°ì¹˜ ë™ì‘ ë³´í˜¸ */
    touch-action: manipulation; 
}

.control-btn:active {
    /* ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ ì‚´ì§ ë“¤ì–´ê°€ëŠ” íš¨ê³¼ */
    box-shadow: 0 1px 0 #3b73b9;
    transform: translateY(3px);
}

#start-button {
    padding: 10px 20px;
    font-size: 1rem;
}
// --- 1. ê¸°ë³¸ ì„¤ì • ---

const BOARD_WIDTH = 10;
const BOARD_HEIGHT = 20;
let score = 0;
let gameBoard = document.getElementById('game-board');
let scoreDisplay = document.getElementById('score');
let gameTimer;
let isGameOver = true;

// 2ì°¨ì› ë°°ì—´: 0ì€ ë¹ˆì¹¸, 1~7ì€ ë¸”ë¡ ì¢…ë¥˜
let board = Array.from({ length: BOARD_HEIGHT }, () => Array(BOARD_WIDTH).fill(0));

// --- í…ŒíŠ¸ë¡œë¯¸ë…¸ (ë¸”ë¡) ëª¨ì–‘ ì •ì˜ ---
// ê° ë¸”ë¡ì˜ ëª¨ì–‘ê³¼ ID (ìƒ‰ê¹” êµ¬ë¶„ìš©)
const TETROMINOES = [
    { shape: [[1, 1, 1, 1]], id: 1, name: 'i' },
    { shape: [[2, 2, 0], [0, 2, 2]], id: 2, name: 'z' },
    { shape: [[0, 3, 3], [3, 3, 0]], id: 3, name: 's' },
    { shape: [[4, 4], [4, 4]], id: 4, name: 'o' },
    { shape: [[5, 5, 5], [0, 0, 5]], id: 5, name: 'l' },
    { shape: [[6, 6, 6], [6, 0, 0]], id: 6, name: 'j' },
    { shape: [[7, 7, 7], [0, 7, 0]], id: 7, name: 't' }
];

let currentPiece;
let currentX;
let currentY;

// --- 2. ê²Œì„ ì‹œì‘ ë° ì •ì§€ ---

document.getElementById('start-button').addEventListener('click', startGame);

function startGame() {
    if (!isGameOver) return; // ì´ë¯¸ ê²Œì„ ì¤‘ì´ë©´ ë¬´ì‹œ
    
    // ë³´ë“œì™€ ì ìˆ˜ ì´ˆê¸°í™”
    board = Array.from({ length: BOARD_HEIGHT }, () => Array(BOARD_WIDTH).fill(0));
    score = 0;
    scoreDisplay.textContent = score;
    isGameOver = false;

    // ì²« ë¸”ë¡ ìƒì„±
    newPiece();
    
    // íƒ€ì´ë¨¸ ì‹œì‘ (1ì´ˆë§ˆë‹¤ ë¸”ë¡ì´ ë–¨ì–´ì§)
    gameTimer = setInterval(moveDown, 1000);
    document.getElementById('start-button').textContent = "ì¼ì‹œì •ì§€";
}

// --- 3. ë¸”ë¡ ë§Œë“¤ê¸° ---

function newPiece() {
    const randomIndex = Math.floor(Math.random() * TETROMINOES.length);
    currentPiece = {
        shape: TETROMINOES[randomIndex].shape,
        id: TETROMINOES[randomIndex].id,
        name: TETROMINOES[randomIndex].name
    };
    currentX = 3; // ì‹œì‘ ìœ„ì¹˜ X
    currentY = 0; // ì‹œì‘ ìœ„ì¹˜ Y

    // ë§Œì•½ ìƒˆ ë¸”ë¡ì´ ìƒì„±ë˜ìë§ˆì ì¶©ëŒí•˜ë©´ ê²Œì„ ì˜¤ë²„!
    if (checkCollision(currentX, currentY, currentPiece.shape)) {
        clearInterval(gameTimer);
        alert('ê²Œì„ ì˜¤ë²„! ì ìˆ˜: ' + score);
        isGameOver = true;
        document.getElementById('start-button').textContent = "ì¬ì‹œì‘";
    }
}

// --- 4. ì¶©ëŒ í™•ì¸ (ê°€ì¥ ì¤‘ìš”í•œ ê·œì¹™) ---

function checkCollision(nextX, nextY, pieceShape) {
    for (let y = 0; y < pieceShape.length; y++) {
        for (let x = 0; x < pieceShape[y].length; x++) {
            if (pieceShape[y][x]) { // ë¸”ë¡ì´ ìˆëŠ” ì¹¸ë§Œ ê²€ì‚¬
                const newX = nextX + x;
                const newY = nextY + y;

                // 1. ë³´ë“œ ë°–ìœ¼ë¡œ ë‚˜ê°€ëŠ”ì§€ í™•ì¸
                if (newX < 0 || newX >= BOARD_WIDTH || newY >= BOARD_HEIGHT) {
                    return true;
                }
                // 2. ì´ë¯¸ ìŒ“ì—¬ìˆëŠ” ë¸”ë¡ê³¼ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
                if (newY >= 0 && board[newY][newX] !== 0) {
                    return true;
                }
            }
        }
    }
    return false;
}

// --- 5. ë¸”ë¡ ì›€ì§ì´ê¸° ---

function movePiece(dx, dy) {
    if (isGameOver) return;
    if (checkCollision(currentX + dx, currentY + dy, currentPiece.shape)) {
        // ì•„ë˜ë¡œ ì´ë™ ì¤‘ ì¶©ëŒí•˜ë©´ ë¸”ë¡ ê³ ì •
        if (dy === 1) {
            lockPiece();
        }
        return false;
    }
    // ì¶©ëŒ ì—†ìœ¼ë©´ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    currentX += dx;
    currentY += dy;
    draw(); // í™”ë©´ì— ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    return true;
}

// 1ì´ˆë§ˆë‹¤ ìë™ í˜¸ì¶œë˜ëŠ” ì•„ë˜ ì´ë™ í•¨ìˆ˜
function moveDown() {
    movePiece(0, 1);
}

// --- 6. ë¸”ë¡ ê³ ì • (ë°”ë‹¥ì— ë‹¿ì•˜ì„ ë•Œ) ---

function lockPiece() {
    for (let y = 0; y < currentPiece.shape.length; y++) {
        for (let x = 0; x < currentPiece.shape[y].length; x++) {
            if (currentPiece.shape[y][x]) {
                // ê²Œì„ ë³´ë“œì— í˜„ì¬ ë¸”ë¡ì˜ ID (ìƒ‰ê¹”) ê¸°ë¡
                board[currentY + y][currentX + x] = currentPiece.id;
            }
        }
    }
    clearLines(); // ì¤„ì´ ê½‰ ì°¼ëŠ”ì§€ í™•ì¸
    newPiece();   // ìƒˆ ë¸”ë¡ ìƒì„±
}

// --- 7. ì¤„ ì§€ìš°ê¸° ---

function clearLines() {
    for (let y = BOARD_HEIGHT - 1; y >= 0; y--) {
        // í•´ë‹¹ ì¤„ì— 0(ë¹ˆì¹¸)ì´ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ê½‰ ì°¬ ì¤„
        if (board[y].every(cell => cell !== 0)) {
            // ê·¸ ì¤„ì„ ì§€ìš°ê³ 
            board.splice(y, 1);
            // ë§¨ ìœ„ì— ìƒˆë¡œìš´ ë¹ˆ ì¤„ì„ ì¶”ê°€
            board.unshift(Array(BOARD_WIDTH).fill(0));
            score += 10;
            scoreDisplay.textContent = score;
            y++; // ì¤„ì„ ì§€ì› ìœ¼ë‹ˆ í•œ ì¹¸ ë‚´ë ¤ê°„ ê·¸ ì¤„ì„ ë‹¤ì‹œ ê²€ì‚¬
        }
    }
}

// --- 8. ë¸”ë¡ íšŒì „ (ê°„ë‹¨í•œ ë²„ì „) ---

function rotatePiece() {
    if (isGameOver) return;
    const rows = currentPiece.shape.length;
    const cols = currentPiece.shape[0].length;
    let newShape = Array(cols).fill(0).map(() => Array(rows).fill(0));

    // ì‹œê³„ ë°©í–¥ 90ë„ íšŒì „ ê³µì‹
    for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
            newShape[x][rows - 1 - y] = currentPiece.shape[y][x];
        }
    }
    
    if (!checkCollision(currentX, currentY, newShape)) {
        currentPiece.shape = newShape;
        draw();
    }
}


// --- 9. í™”ë©´ì— ê·¸ë¦¬ê¸° (ë Œë”ë§) ---

function draw() {
    // 1. ë³´ë“œ ì „ì²´ë¥¼ ë‹¤ì‹œ ê·¸ë¦¼
    gameBoard.innerHTML = '';
    for (let y = 0; y < BOARD_HEIGHT; y++) {
        for (let x = 0; x < BOARD_WIDTH; x++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            if (board[y][x] !== 0) {
                // ì´ë¯¸ ê³ ì •ëœ ë¸”ë¡ í‘œì‹œ
                cell.classList.add(`block-${TETROMINOES.find(t => t.id === board[y][x]).name}`);
            }
            gameBoard.appendChild(cell);
        }
    }

    // 2. í˜„ì¬ ë–¨ì–´ì§€ê³  ìˆëŠ” ë¸”ë¡ì„ ë³´ë“œ ìœ„ì— ê²¹ì³ì„œ ê·¸ë¦¼
    for (let y = 0; y < currentPiece.shape.length; y++) {
        for (let x = 0; x < currentPiece.shape[y].length; x++) {
            if (currentPiece.shape[y][x]) {
                const cellIndex = (currentY + y) * BOARD_WIDTH + (currentX + x);
                const cell = gameBoard.children[cellIndex];
                if (cell) {
                    // ë–¨ì–´ì§€ëŠ” ë¸”ë¡ ìƒ‰ê¹” í‘œì‹œ
                    cell.classList.add(`block-${currentPiece.name}`);
                }
            }
        }
    }
}

// --- 10. ëª¨ë°”ì¼ ë²„íŠ¼ì— í„°ì¹˜ ì—°ê²° (ì†ê°€ë½ì— ë°˜ì‘) ---

document.getElementById('left').addEventListener('touchstart', (e) => {
    e.preventDefault(); // ê¸°ë³¸ ë™ì‘(ìŠ¤í¬ë¡¤) ë§‰ê¸°
    movePiece(-1, 0); // ì™¼ìª½ ì´ë™
});

document.getElementById('right').addEventListener('touchstart', (e) => {
    e.preventDefault();
    movePiece(1, 0); // ì˜¤ë¥¸ìª½ ì´ë™
});

document.getElementById('down').addEventListener('touchstart', (e) => {
    e.preventDefault();
    movePiece(0, 1); // í•œ ì¹¸ ì•„ë˜ë¡œ ì´ë™
});

document.getElementById('rotate').addEventListener('touchstart', (e) => {
    e.preventDefault();
    rotatePiece(); // íšŒì „
});

// ì²˜ìŒ ê²Œì„ì´ ë¡œë“œë  ë•Œ í™”ë©´ì„ í•œ ë²ˆ ê·¸ë¦½ë‹ˆë‹¤.
draw();
